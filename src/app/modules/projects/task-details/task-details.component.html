<mat-dialog-content class="task-detail-content">
  <div class="two-column-layout">

    <!-- Columna Izquierda -->
    <div class="info-section">
      <h3>Informaci贸n</h3>
      <p><strong>Descripci贸n:</strong> {{ tarea.descripcion }}</p>
      <p><strong>Ubicaci贸n:</strong> {{ tarea.ubicacion || 'No especificada' }}</p>
      <p><strong>Estado:</strong> {{ tarea.estadoNombre }}</p>
      <p><strong>Fecha Inicio Estimado:</strong> {{ tarea.fechaInicioEstimado | date:'mediumDate' }}</p>
      <p><strong>Fecha Fin Estimado:</strong> {{ tarea.fechaFinEstimado | date:'mediumDate' }}</p>

      <h3>Adjuntos</h3>
      <input type="file" (change)="seleccionarArchivo($event)" />
      <button mat-flat-button color="primary" (click)="subirArchivo()" [disabled]="!archivoSeleccionado || loading">
        Subir Archivo
      </button>

      <div class="attachments" *ngIf="tarea.adjuntos?.length > 0; else sinAdjuntos">
        <div class="attachment-item" *ngFor="let a of tarea.adjuntos">
          <a [href]="a.archivoUrl" target="_blank">{{ a.nombreArchivo }}</a>
          <small>{{ a.fechaSubida | date:'short' }}</small>
        </div>
      </div>

      <ng-template #sinAdjuntos>
        <p class="no-attachments">No hay adjuntos.</p>
      </ng-template>

      <div *ngIf="tarea.colaboradores?.length > 0">
        <h4>Colaboradores actuales:</h4>
        <ul>
          <li *ngFor="let c of tarea.colaboradores">{{ c.name }} {{ c.lastname }}</li>
        </ul>
      </div>

      <!-- Secci贸n para asignar colaboradores -->
      <h3>Asignar Colaboradores</h3>
      <mat-form-field appearance="fill" style="width: 100%;">
        <mat-label>Selecciona colaboradores</mat-label>
        <mat-select multiple [(ngModel)]="usuariosSeleccionados" [disabled]="loading" name="usuarios">
          <mat-option *ngFor="let usuario of usuariosDisponibles" [value]="usuario.id">
            {{ usuario.Name }} {{ usuario.Lastname }} 
          </mat-option>
        </mat-select>
      </mat-form-field>
      <button mat-raised-button color="primary" (click)="asignarColaboradores()" 
        [disabled]="usuariosSeleccionados.length === 0 || loading">
        Asignar colaboradores
      </button>
    </div>

    <!-- Columna Derecha -->
    <div class="comments-section">
      <h3>Comentarios</h3>

      <div class="chat-messages" *ngIf="tarea.comentarios?.length > 0; else sinComentarios">
        <div *ngFor="let c of tarea.comentarios" class="message-bubble">
          <div class="message-header">
            <strong>{{ c.UsuarioNombre }}</strong>
            <span>{{ c.FechaComentario | date:'short' }}</span>
          </div>
          <div class="message-text">{{ c.ComentarioTexto }}</div>
        </div>
      </div>

      <ng-template #sinComentarios>
        <p class="no-comments">No hay comentarios.</p>
      </ng-template>

      <div class="chat-input-bar">
        <mat-form-field appearance="outline" class="input-field">
          <mat-label>Nuevo Comentario</mat-label>
          <textarea matInput [(ngModel)]="nuevoComentario" rows="2" placeholder="Escribe un comentario..."></textarea>
        </mat-form-field>
      </div>
    </div>

  </div>

  <app-loading-spinner [visible]="loading"></app-loading-spinner>
</mat-dialog-content>

<mat-dialog-actions align="end" class="dialog-actions">
  <button mat-stroked-button color="primary" (click)="editar()" [disabled]="loading">Editar</button>
  <button mat-stroked-button color="warn" (click)="cerrar()" [disabled]="loading">Cerrar</button>
  <button mat-flat-button color="accent" (click)="enviarComentario()" [disabled]="!nuevoComentario || loading">
    Enviar Comentario
  </button>
</mat-dialog-actions>
